{"version":3,"file":"focus-management.esm.js","sources":["../../src/utils/focus-management.ts"],"sourcesContent":["import { match } from './match'\n\n// Credit:\n//  - https://stackoverflow.com/a/30753870\nlet focusableSelector = [\n  '[contentEditable=true]',\n  '[tabindex]',\n  'a[href]',\n  'area[href]',\n  'button:not([disabled])',\n  'iframe',\n  'input:not([disabled])',\n  'select:not([disabled])',\n  'textarea:not([disabled])',\n]\n  .map(\n    process.env.NODE_ENV === 'test'\n      ? // TODO: Remove this once JSDOM fixes the issue where an element that is\n        // \"hidden\" can be the document.activeElement, because this is not possible\n        // in real browsers.\n        selector => `${selector}:not([tabindex='-1']):not([style*='display: none'])`\n      : selector => `${selector}:not([tabindex='-1'])`\n  )\n  .join(',')\n\nexport enum Focus {\n  /** Focus the first non-disabled element */\n  First = 1 << 0,\n\n  /** Focus the previous non-disabled element */\n  Previous = 1 << 1,\n\n  /** Focus the next non-disabled element */\n  Next = 1 << 2,\n\n  /** Focus the last non-disabled element */\n  Last = 1 << 3,\n\n  /** Wrap tab around */\n  WrapAround = 1 << 4,\n\n  /** Prevent scrolling the focusable elements into view */\n  NoScroll = 1 << 5,\n}\n\nexport enum FocusResult {\n  /** Something went wrong while trying to focus. */\n  Error,\n\n  /** When `Focus.WrapAround` is enabled, going from position `N` to `N+1` where `N` is the last index in the array, then we overflow. */\n  Overflow,\n\n  /** Focus was successful. */\n  Success,\n\n  /** When `Focus.WrapAround` is enabled, going from position `N` to `N-1` where `N` is the first index in the array, then we underflow. */\n  Underflow,\n}\n\nenum Direction {\n  Previous = -1,\n  Next = 1,\n}\n\nexport function getFocusableElements(container: HTMLElement | null = document.body) {\n  if (container == null) return []\n  return Array.from(container.querySelectorAll<HTMLElement>(focusableSelector))\n}\n\nexport enum FocusableMode {\n  /** The element itself must be focusable. */\n  Strict,\n\n  /** The element should be inside of a focusable element. */\n  Loose,\n}\n\nexport function isFocusableElement(\n  element: HTMLElement,\n  mode: FocusableMode = FocusableMode.Strict\n) {\n  if (element === document.body) return false\n\n  return match(mode, {\n    [FocusableMode.Strict]() {\n      return element.matches(focusableSelector)\n    },\n    [FocusableMode.Loose]() {\n      let next: HTMLElement | null = element\n\n      while (next !== null) {\n        if (next.matches(focusableSelector)) return true\n        next = next.parentElement\n      }\n\n      return false\n    },\n  })\n}\n\nexport function focusElement(element: HTMLElement | null) {\n  element?.focus({ preventScroll: true })\n}\n\nexport function focusIn(container: HTMLElement | HTMLElement[], focus: Focus) {\n  let elements = Array.isArray(container) ? container : getFocusableElements(container)\n  let active = document.activeElement as HTMLElement\n\n  let direction = (() => {\n    if (focus & (Focus.First | Focus.Next)) return Direction.Next\n    if (focus & (Focus.Previous | Focus.Last)) return Direction.Previous\n\n    throw new Error('Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last')\n  })()\n\n  let startIndex = (() => {\n    if (focus & Focus.First) return 0\n    if (focus & Focus.Previous) return Math.max(0, elements.indexOf(active)) - 1\n    if (focus & Focus.Next) return Math.max(0, elements.indexOf(active)) + 1\n    if (focus & Focus.Last) return elements.length - 1\n\n    throw new Error('Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last')\n  })()\n\n  let focusOptions = focus & Focus.NoScroll ? { preventScroll: true } : {}\n\n  let offset = 0\n  let total = elements.length\n  let next = undefined\n  do {\n    // Guard against infinite loops\n    if (offset >= total || offset + total <= 0) return FocusResult.Error\n\n    let nextIdx = startIndex + offset\n\n    if (focus & Focus.WrapAround) {\n      nextIdx = (nextIdx + total) % total\n    } else {\n      if (nextIdx < 0) return FocusResult.Underflow\n      if (nextIdx >= total) return FocusResult.Overflow\n    }\n\n    next = elements[nextIdx]\n\n    // Try the focus the next element, might not work if it is \"hidden\" to the user.\n    next?.focus(focusOptions)\n\n    // Try the next one in line\n    offset += direction\n  } while (next !== document.activeElement)\n\n  // This is a little weird, but let me try and explain: There are a few scenario's\n  // in chrome for example where a focused `<a>` tag does not get the default focus\n  // styles and sometimes they do. This highly depends on whether you started by\n  // clicking or by using your keyboard. When you programmatically add focus `anchor.focus()`\n  // then the active element (document.activeElement) is this anchor, which is expected.\n  // However in that case the default focus styles are not applied *unless* you\n  // also add this tabindex.\n  if (!next.hasAttribute('tabindex')) next.setAttribute('tabindex', '0')\n\n  return FocusResult.Success\n}\n"],"names":["focusableSelector","map","process","env","NODE_ENV","selector","join","Focus","FocusResult","Direction","getFocusableElements","container","document","body","Array","from","querySelectorAll","FocusableMode","isFocusableElement","element","mode","Strict","match","matches","Loose","next","parentElement","focusElement","focus","preventScroll","focusIn","elements","isArray","active","activeElement","direction","First","Next","Previous","Last","Error","startIndex","Math","max","indexOf","length","focusOptions","NoScroll","offset","total","undefined","nextIdx","WrapAround","Underflow","Overflow","hasAttribute","setAttribute","Success"],"mappings":"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"}